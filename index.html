<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–£–¥–∞–ª–µ–Ω–∏–µ —Å–ª–æ–µ–≤</title>
    <link rel="icon" href="icon.png">
    <style>
        body {
            font-family: sans-serif;
            background: #222;
            color: white;
            display: flex; flex-direction: column; align-items: center;
            padding: 20px;
        }
        .container {
            max-width: 1000px; width: 100%;
            background: #333; padding: 20px; border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            text-align: center;
        }
        canvas {
            max-width: 100%; height: auto;
            border: 2px solid #555;
            margin-top: 20px;
            background-image: 
                linear-gradient(45deg, #444 25%, transparent 25%), 
                linear-gradient(-45deg, #444 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, #444 75%),
                linear-gradient(-45deg, transparent 75%, #444 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            cursor: crosshair;
        }
        .controls {
            margin: 20px 0;
            display: flex; gap: 15px; justify-content: center; align-items: center;
            flex-wrap: wrap;
        }
        button, label {
            background: #4a6f22; color: white; padding: 10px 20px;
            border: none; border-radius: 5px; cursor: pointer; font-size: 16px;
        }
        button:hover { background: #5d8a2a; }
        input[type="range"] { cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <h1>–£–¥–∞–ª–µ–Ω–∏–µ —Å–ª–æ–µ–≤</h1>
    <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ç–æ, –∑–∞—Ç–µ–º –∫–ª–∏–∫–Ω–∏—Ç–µ –ø–æ —Ñ–æ–Ω—É –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏</p>

    <div class="controls">
        <label for="upload">üìÅ –í—ã–±—Ä–∞—Ç—å —Ñ–æ—Ç–æ</label>
        <input type="file" id="upload" accept="image/*" style="display:none">

        <div>
            –ü–æ—Ä–æ–≥: <input type="range" id="threshold" min="0" max="150" value="30">
        </div>

        <button id="download">üíæ –°–∫–∞—á–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç</button>
    </div>

    <canvas id="canvas"></canvas>
</div>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const upload = document.getElementById('upload');
    const thresholdInput = document.getElementById('threshold');
    const downloadBtn = document.getElementById('download');

    let originalImage = null;

    upload.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (event) => {
            const img = new Image();
            img.onload = () => {
                originalImage = img;
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);
            };
            img.src = event.target.result;
        };
        reader.readAsDataURL(file);
    });

    canvas.addEventListener('click', (e) => {
        if (!originalImage) return;

        const rect = canvas.getBoundingClientRect();
        const scaleX = canvas.width / rect.width;
        const scaleY = canvas.height / rect.height;
        const x = Math.floor((e.clientX - rect.left) * scaleX);
        const y = Math.floor((e.clientY - rect.top) * scaleY);

        const pixel = ctx.getImageData(x, y, 1, 1).data;
        const targetR = pixel[0];
        const targetG = pixel[1];
        const targetB = pixel[2];

        removeColor(targetR, targetG, targetB);
    });

    function removeColor(tr, tg, tb) {
        const threshold = parseInt(thresholdInput.value);

        ctx.drawImage(originalImage, 0, 0);

        const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const data = imgData.data;

        for (let i = 0; i < data.length; i += 4) {
            const r = data[i];
            const g = data[i+1];
            const b = data[i+2];

            const distance = Math.sqrt(
                Math.pow(r - tr, 2) +
                Math.pow(g - tg, 2) +
                Math.pow(b - tb, 2)
            );

            if (distance < threshold) {
                data[i + 3] = 0;
            }
        }

        ctx.putImageData(imgData, 0, 0);
    }

    downloadBtn.addEventListener('click', () => {
        const link = document.createElement('a');
        link.download = 'no-background.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
    });
</script>
</body>
</html>
